<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <!-- 합쳐지고 최소화된 최신 CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">

    <!-- 부가적인 테마 -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">

    <!-- 합쳐지고 최소화된 최신 자바스크립트 -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
    <script th:src="@{/js/jquery.star-rating-svg.js}"></script>
    <link rel="stylesheet" th:href="@{/css/star-rating-svg.css}">
    <title>Title</title>
    <script>
        var sequence = 0;
        let score;
        var html = '';
        function testajax() {
            var sendData = {"sequence":sequence}
            $.ajax({
                url:'/movies/is_ajax',
                method :'POST',
                data: sendData,
                success : function (resp) {
                    sequence += 20;
                    $.each(resp, function (index, item) {
                        html += '<div class="col-xs-4 col-sm-3 col-md-3 col-lg-2 movie_img"  id="' + item["id"] + '" style="height: 500px">';
                        html += '<div class="thumbnail">';
                        html += '<a href="/movies/view/' + item["id"] + '">';
                        html += '<img src="' + item["img_link"] + '" style="max-width: 100%; height: auto" class="movie_img" >';
                        html += '</a><div class="caption"';
                        html += '<input type="hidden" id="title_detail_'+ item["id"] +'" value="'+ item["title"] +'">'
                        html += '<div style="position: absolute; top:0px; width: 100%; height: 100%;"  id = "detail_' + item["id"] + '" class="test"></div></div></div></div>';

                    })
                    document.getElementById('123').innerHTML = html;
                    //starClick();
                }
            })
        }

        function starClick()  {
            $('.star1').starRating({
                totalStars: 5,
                starSize: 20,
                emptyColor: 'lightgray',
                hoverColor: 'salmon',
                activeColor: 'cornflowerblue',
                initialRating: 0,
                strokeWidth: 0,
                useGradient: false,
                callback: function(currentRating){
                    score = currentRating;
                }
            });
        }

        $(function () {
            testajax();
            starClick();
            $(document).on("click", ".star1", function () {
                let click_movie_id = $(this).attr('id');
                let sendData = {"movie_id":click_movie_id,"input":score};
                $.ajax({
                    url:'/movies/is_ajaxx',
                    method :'GET',
                    data:sendData
                })
                alert("감사합니다");
            })

            $(document).on("mouseover",".test",function (){
                let click_class = $(this).attr('id');
                let title = "#title_" + click_class;
                let ti = $(title).attr('value')
                let text = '<p>' + ti + '</p>';
                text += '<div class="star1"></div>';
                document.getElementById(click_class).innerHTML = text;
                starClick()
                event.stopPropagation();
            })

            $(document).on("mouseout",".test",function (){
                let click_class = $(this).attr('id');
                let div_id = 'detail_' + click_class;
                //let title = "#title_" + click_class;
                //let ti = $(title).attr('value')
                let text = '';
                document.getElementById(click_class).innerHTML = text;
                starClick()
            })

            $(document).scroll(function () {
                var maxHeight = $(document).height();
                var currentScroll = $(window).scrollTop() + $(window).height();

                if (maxHeight <= currentScroll) {
                    testajax();
                }
            })
        })
    </script>
</head>
<body>
<thead>
<tr>
    <th>#</th>
    <th>영화</th>
    <a href="/">홈으로</a>
</tr>
</br>
</thead>
<tbody>

<!--<td th:each="movie : ${movieList}">-->
<!--    <div style="display:inline-block; height: auto; width: 18%; border: 1px solid red; text-align: center;-->
<!--overflow: hidden;">-->
<!--        <img th:src="${movie.img_link}" style="height: auto; width: 100%" th:id="${movie.id}"-->
<!--        class="movie_img">-->
<!--        <p th:text="${movie.title}"><p>-->
<!--    </div>-->
<!--</td>-->
<!--<input type="button" onclick="testajax()" value="인생씨발...">-->
<table id = "123">
</table>
</tbody>
</body>
</html>
